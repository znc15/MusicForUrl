# 服务器端口
PORT=3000

# 环境标识（production 时强制要求 ENCRYPTION_KEY）
NODE_ENV=development

# Cookie 加密密钥
# - 生产环境：必须手动配置，至少16位，建议32位字符
# - 开发环境：可不配置，会自动生成并持久化到 data/.encryption_key
# ENCRYPTION_KEY=your-32-character-secret-key-here

# 可选：管理员密码（用于 /api/hls/cache/* 管理接口）
# 生产环境未设置时管理接口会被禁用
ADMIN_PASSWORD=

# 可选：是否启用 HLS 管理接口（默认关闭）
# 仅在同时配置 ADMIN_PASSWORD 时生效
# HLS_ADMIN_ENABLED=1

# 可选：站点访问密码
SITE_PASSWORD=

# 歌单缓存时间（秒，默认24小时）
CACHE_TTL=86400

# ===================
# 限流配置（可选）
# ===================

# 信任代理（在 Nginx/Cloudflare 后面时设置）
# 不要使用 true（等同“信任所有代理”，存在安全风险，且 express-rate-limit 会拒绝该配置）
# 推荐：单层反代用 1；两层反代（如 Cloudflare + Nginx）用 2；更多层按实际填写 3...
# 或者填写具体代理 IP/子网（更精确），例如 "127.0.0.1"、"10.0.0.0/8"、"loopback"
# 不需要代理时留空或删除此行
# TRUST_PROXY=1

# 公网访问地址（用于生成 HLS segment URL）
# 当服务部署在反向代理后面时，如果 TRUST_PROXY 无法正确获取 host，
# 可以直接配置此项来确保 HLS m3u8 中的 URL 正确
# 示例: https://music.example.com
# BASE_URL=

# 全局 API 限流（每分钟请求数，默认200）
RATE_LIMIT_GLOBAL=100

# 认证接口限流（每分钟，默认10，防止暴力破解）
RATE_LIMIT_AUTH=10

# 歌单解析限流（每分钟，默认30）
RATE_LIMIT_PARSE=10

# HLS stream.m3u8 限流（每分钟，默认60）
RATE_LIMIT_HLS_STREAM=15

# HLS 分片（.ts）限流（每分钟，默认600）
# 注意：播放器拉分片会比较频繁，过低会导致播放卡顿
RATE_LIMIT_HLS_SEGMENT=300

# ===================
# HLS 转码配置（可选）
# ===================

# 最大并发转码任务数（默认2）
HLS_MAX_CONCURRENT_JOBS=1

# 最大等待队列长度（默认10，超出返回503）
HLS_MAX_QUEUE=3

# 下载超时（毫秒，默认60000=60秒）
HLS_DOWNLOAD_TIMEOUT=60000

# 下载最大字节数（默认100MB，高音质长歌曲可能超过50MB）
HLS_DOWNLOAD_MAX_SIZE=104857600

# FFmpeg 超时（毫秒，默认180000=3分钟）
# 说明：弱服务器/长歌曲转码可能需要更久；建议按机器情况调大（例如 600000=10分钟）。
# 该超时为“无输出/无进展超时”，只要 FFmpeg 持续输出进度就不会触发。
HLS_FFMPEG_TIMEOUT=180000

# HLS 分片时长（秒，默认 10；调大可减少 .ts 请求数，但会降低拖拽/切歌响应）
HLS_SEGMENT_DURATION=10

# 自动预加载前 N 首歌（默认 1）
HLS_AUTO_PRELOAD_COUNT=0

# ===================
# HLS 分片缓存配置（可选）
# ===================

# TS 分片缓存最大容量
# - 也可以用字节精确控制（优先级更高）：
#   HLS_CACHE_MAX_SIZE=5368709120
HLS_CACHE_MAX_SIZE_GB=2

# 缓存最大保留时间（小时，默认 24）
HLS_CACHE_MAX_AGE_HOURS=24

# 定时清理间隔（分钟，默认 60）
HLS_CACHE_CLEANUP_INTERVAL_MINUTES=60

# 超限时清理到 maxSize * ratio 以下（0~1，默认 0.8）
HLS_CACHE_CLEANUP_TARGET_RATIO=0.8

# ===================
# 日志配置（可选）
# ===================

# 输出详细 HLS 日志（分片命中/预加载进度等）
# 默认关闭，生产环境建议保持关闭以减少日志噪音
# LOG_HLS_VERBOSE=1

# ===================
# 下载安全配置（可选）
# ===================

# 额外允许的下载 host 模式（逗号分隔的正则表达式）
# 默认已允许网易云音频/封面 CDN (*.music.126.net)
# 如需允许其他域名，可在此添加
# HLS_DOWNLOAD_ALLOW_HOSTS=^example\.com$,^cdn\.example\.com$

# ===================
# 音质配置（可选）
# ===================

# 音质级别（推荐，二选一即可）
# 可选值: low(128kbps), medium(192kbps), high(320kbps), lossless(无损)
# 默认 low，文件小、下载快、转码快
MUSIC_QUALITY=low

# 登录 token 有效期（小时，默认 168=7天）
TOKEN_TTL_HOURS=168

# 播放链接短时签名 token 有效期（秒，最小 30，最大 172800=48小时）
PLAYBACK_TOKEN_TTL_SECONDS=172800

# 或者直接指定码率（单位 bps）
# 128000 / 192000 / 320000 / 999000
# MUSIC_BITRATE=128000

# ===================
# 视频轻量随机背景图（可选）
# ===================

# 视频轻量模式随机背景图 API（支持 302/JSON/纯文本 URL）
LITE_VIDEO_BG_API_URL=https://api.miaomc.cn/image/get

# 视频轻量背景图 API 超时（毫秒，范围 1000~30000）
LITE_VIDEO_BG_API_TIMEOUT_MS=8000

# 封面视频输出分辨率（默认 1920x1080）
COVER_WIDTH=640
COVER_HEIGHT=360

# 封面视频帧率（FPS） 
# 静态封面不需要高帧率，降低可显著减少转码 CPU 
# - 不配置时默认 5 
# - 建议弱服务器：1~5 
COVER_FPS=1 

# 限制单个 FFmpeg 进程线程数（0=自动）
# 弱服务器建议 1~2；并发转码时可防止 CPU 打满
HLS_FFMPEG_THREADS=1

# 默认封面 URL（可选，不填则使用内置默认值）
# DEFAULT_COVER_URL=
